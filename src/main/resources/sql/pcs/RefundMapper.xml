<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.happyjob.study.pcs.dao.RefundDao">

  <!-- 반품서 목록 조회(기본)  -->
  <select id="selectRefundList" resultType="kr.happyjob.study.pcs.model.RefundModel">
    
    SELECT pur.purch_list_no
         , pur.order_cd
         , pur.return_date
         , pur.return_qty
         , sup.supply_nm
         , sup.supply_cd
         , pro.prod_nm
         , pro.m_ct_cd
      FROM tb_scm_purchase_list pur
           LEFT JOIN tb_order ord
           ON pur.order_cd  = ord.order_cd
           LEFT JOIN tb_scm_product pro
           ON ord.product_cd = pro.product_cd
           LEFT JOIN tb_scm_supply sup
           ON pro.supply_cd = sup.supply_cd
  ORDER BY purch_list_no DESC
   
  
  </select>
  
  <!-- 반품서 목록 총 개수 조회 -->
  <select id="countRefundList" resultType="int">
  
    SELECT count(*)
      FROM tb_scm_purchase_list
     WHERE return_mng_id IS NOT NULL
     
  </select>
  
  <!-- 반품서 목록 조건별 검색. 나중  -->
  <select id="selectConditionRefundList" resultType="kr.happyjob.study.pcs.model.RefundModel" parameterType="String">
    
    SELECT li.refund_list_no
         , li.order_cd
         , sup.supply_nm
         , sup.supply_cd
         , pro.prod_nm
         , pro.m_ct_cd,ord.refund_cnt
         , li.submit_date
         , li.refund_date
      FROM tb_scm_refund_list li
         , tb_order ord
         , tb_scm_product pro
         , tb_scm_supply sup
     WHERE li.scm_id IS NULL 
       AND li.order_cd = ord.order_cd 
       AND ord.product_cd = pro.product_cd 
       AND pro.supply_cd = sup.supply_cd
       <choose>
        <when test="selected == #{prod_nm}">
          AND pro.prod_nm LIKE CONCAT('%',#{prod_nm},'%' )
        </when>
       </choose>
  ORDER BY li.refund_list_no DESC
  
  </select>
  
  <!-- 반품서 단건 조회  -->
  <select id="selectOneRefund" resultType="java.util.Map" parameterType="String">
  
    SELECT li.refund_list_no
         , li.approve_id
         , sup.supply_nm
         , sup.supply_cd
         , pro.prod_nm
         , pro.m_ct_cd
         , pro.product_cd
         , pro.purchase_price
         , ord.refund_cnt
         , war.warehouse_cd
         , war.addr
         , pur.purch_date
         , pur.desired_delivery_date
      FROM tb_scm_refund_list li
         , tb_order ord
         , tb_scm_product pro
         , tb_scm_supply sup
         , tb_scm_purchase_list pur
         , tb_scm_warehouse war
     WHERE li.scm_id IS NOT NULL 
       AND li.order_cd = ord.order_cd 
       AND ord.product_cd = pro.product_cd 
       AND pro.supply_cd = sup.supply_cd
       AND li.refund_list_no = #{ refund_list_no }
       
  </select>
  
   
</mapper>